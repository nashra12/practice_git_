dotfiles
========

This is my collection of user/application settings ("dotfiles") and utilitary
scripts. It is the product of my old dotfiles repository and [ayekat's dotfiles
repository](https://github.com/ayekat/dotfiles). Most of the files here come
from that repository, somewhere on the internet or my own old dolfiles.

These scripts are mostly adapted to my personal needs, and some scripts may make
[unfortunate assumptions about the environment](#assumptions) (most likely not
considered "standard"). Nevertheless, I try to keep them as clean and non-WTF as
possible, and people are invited to take a look at them, get ideas for their own
dotfiles, and drop comments if something seems odd.

For using the dotfiles, I place them in some location (e.g.
`~/.local/lib/dotfiles`), then symlink each file/directory to their respective
locations.


XDG/FHS
-------

I try to keep the top-level user home directory as clean as possible by
honouring the [XDG base directory
specification](https://specifications.freedesktop.org/basedir-spec/latest/index.html),
adapted to recreate the [Linux file system
hierarchy](http://linux.die.net/man/7/hier) (FHS) under `~/.local`. In detail,
this means that the following environment variables are set:

| Variable          | Location             |
| ----------------- | -------------------- |
| `XDG_CACHE_HOME`  | `~/.local/var/cache` |
| `XDG_CONFIG_HOME` | `~/.local/etc`       |
| `XDG_DATA_HOME`   | `~/.local/var/lib`   |
| `XDG_RUNTIME_DIR` | `~/.local/run`       |
| `XDG_LIB_HOME`    | `~/.local/lib`       |
| `XDG_LOG_HOME`    | `~/.local/var/log`   |

> ### Notes
> * `XDG_LIB_HOME` and `XDG_LOG_HOME` are non-standard, but they are
>   nevertheless necessary for representing the FHS locally.
> * `~/.local/run` **must** be a symbolic link to `/run/user/<uid>`.

Furthermore, user-specific applications and scripts are expected to be placed in
`~/.local/bin`.

Unfortunately, some application do not honour the XDG basedir specification, and
setting above variables is often not enough. Various approaches are taken to
achieve the goal:

* For applications using their own environment variables, a simple entry in
  `~/.pam_environment` is usually enough.
* For applications accepting command line arguments, there are local "fake"
  (wrapper) scripts in `.local/bin` that call the real application with the
  right arguments.
* For applications where neither of these apply, I weep (or perhaps resort to
  some ugly LD\_PRELOAD hacks, see issue #7).

See [XDG Base Directory
support](https://wiki.archlinux.org/index.php/XDG_Base_Directory_support) in the
Arch Linux wiki for more details about which applications honour the specs.


Assumptions
-----------

The dotfiles have primarily been used on Arch Linux (and for limited use-cases
on Debian, too, although there are minor issues with tmux and [major issues with
PAM](https://github.com/ayekat/dotfiles/issues/8), both related to Debian
shipping antique versions of software).

* For setting the [XDG basedir variables](#xdgfhs) I use `~/.pam_environment`,
  which is read by [PAM](https://wiki.archlinux.org/index.php/PAM). If other
  authentication frameworks are used, these dotfiles will not work as-is.

* `/usr/sbin`, `/sbin` and `/bin` are assumed to have been
  [merged](https://www.archlinux.org/news/binaries-move-to-usrbin-requiring-update-intervention/)
  into `/usr/bin`, so all absolute paths to system-widely available software
  point into `/usr/bin` (note that this is a more extreme case of the [`/usr`
  merge](https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/)).

* Lots of configuration files will attempt to run scripts and binaries in
  `~/.local/bin/utils`, provided by the [utils
  repository](https://github.com/ayekat/utils). The missing of latter should be
  non-fatal, though.


Policies
--------

* Application history generally goes into `XDG_DATA_HOME` (see f1147a9 for the
  reasoning). The only things that go into `XDG_LOG_HOME` are "real" logs, i.e.
  data that is no longer read and used by the application itself. The only
  things that go into `XDG_CACHE_HOME` are files that are non-essential and can
  quickly be regenerated by the application, if needed (which is both not the
  case for history files).

* Applications whose configuration is mixed up with other data (or generally not
  supposed to be manually edited) is put into `XDG_DATA_HOME`, reason being that
  I would like to track `XDG_CONFIG_HOME` with git as much as possible. This of
  course only works for applications that allow configuring the location of
  "config" files.

* Shell-agnostic configuration should happen in `XDG_CONFIG_HOME/sh`. This
  allows other, non-zsh shells to work correctly, too, without having to
  duplicate all the shell configuration. The shell-agnostic configuration is
  stored in `environment`, `login` and `config` as well as `profile` and the
  `profile.d` directory for application-specific profile snippets, while only
  shell-specific configuration (prompts, input, history, etc.) should happen in
  zsh's config.


Deployment
--------

This is mostly a reference and SHOULD NOT be just copied and pasted into a shell.
```
~ cd
~ git clone https://github.com/roosemberth/dotfiles
~ [ -e .local ] && mv .local local.old
~ ln -s dotfiles/.pam_environment .pam_environment
~ ln -s dotfiles/.local .local
~ ln -sf .local/etc/xmonad .xmonad
~ ln -sf .local/etc/tmux/def.tmux.conf .tmux.conf
~ ln -sf .local/etc/tmuxinator .tmuxinator
~ cd .local
~ mkdir run tmp var
```
On debian, don't forget to add this line on `/etc/pam.d/login`
```
session       required   pam_env.so user_readenv=1
```
As much as we avoid hardcoding personal information, there are always some bits
of us written in stone, `grep -Rs "roosemberth" --exclude-dir=var` may help
finding things you might need to replace for this to work properly.
